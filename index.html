<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>1차시 | 사진 나라의 수상한 단서 찾기 : 진짜와 다른 점을 찾아요</title>
  <style>
    :root{
      --bg:#fff8e6;--panel:#ffffffee;--muted:#64748b;--text:#1f2937;--accent:#fbbf24;--accent2:#fb923c;--good:#16a34a;--bad:#ef4444;--ring:#f59e0b;--soft:#f8fafc;--border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif}
    .max{max-width:1100px;margin:0 auto;padding:20px;display:flex;flex-direction:column;height:100%;}
    .card{background:var(--panel);backdrop-filter:blur(8px);border:1px solid var(--border);border-radius:18px;box-shadow:0 8px 24px #00000010}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .grow{flex:1}
    .headline{font-size:clamp(22px,3.2vw,30px);font-weight:900;margin:0}
    .sub{color:var(--muted);font-size:14px}
    .btn, .ghost{appearance:none;border:0;border-radius:18px;padding:10px 18px;font-size:18px;font-weight:800;cursor:pointer}
    header {margin-bottom: 16px; flex-shrink: 0;}
    .btn{color:#111827;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 18px #f59e0b33}
    .ghost{background:#fff;color:var(--text);border:1px solid var(--border)}
    label{font-size:18px}
    .screen{padding:22px}
    .screens-wrapper { flex-grow: 1; min-height: 0; display: flex; flex-direction: column; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    .thumb{position:relative;border-radius:16px;overflow:hidden;border:1px solid var(--border);background:#fff;display:flex;flex-direction:column;}
    .thumb img{width:100%;flex-grow:1;min-height:0;object-fit:contain;display:block}
    .thumb .ghost{position:absolute;right:12px;bottom:12px;padding:14px 18px;font-size:18px}
    .stage{position:relative;border-radius:18px;overflow:hidden;border:1px solid var(--border);background:var(--soft);}
    .stage img{width:100%;height:100%;object-fit:contain;display:block}
    #screen-play:not([hidden]) { display: flex; flex-direction: column; flex-grow: 1; }
    #screen-play:not([hidden]) .stage { flex-grow: 1; min-height: 0; }
    .hotspot{position:absolute;border:3px dashed var(--ring);border-radius:999px;transform:translate(-50%,-50%);width:72px;height:72px;pointer-events:none;opacity:0;transition:.25s}
    .hotspot.found{border-color:var(--good);box-shadow:0 0 0 6px #16a34a33}
    .ping{position:absolute;inset:0;border-radius:inherit;border:3px solid transparent;animation:ping 1.1s ease-out 2}
    @keyframes ping{0%{box-shadow:0 0 0 0 #f59e0b55}100%{box-shadow:0 0 0 24px transparent}}
    .toast{position:fixed;left:50%;bottom:26px;transform:translateX(-50%);background:#111827e6;color:#fff;border:1px solid #00000022;padding:12px 16px;border-radius:14px;font-size:16px}
    .confetti{position:fixed;inset:0;pointer-events:none}
    .chip{position:absolute;width:10px;height:10px;border-radius:2px;opacity:0;animation:fall 1.2s ease-out forwards}
    @keyframes fall{0%{transform:translateY(-20px) rotate(0);opacity:1}90%{opacity:1}100%{transform:translateY(120vh) rotate(480deg);opacity:0}}
    .divider{height:1px;background:var(--border);margin:12px 0}
    .kudos{font-weight:900;color:#111827;background:linear-gradient(135deg,#34d399,#fbbf24);-webkit-background-clip:text;background-clip:text;color:transparent}
    footer{margin-top:18px;text-align:center;color:#6b7280;font-size:13px; flex-shrink: 0;}
    .difficulty-row { font-size: clamp(16px, 2.5vw, 20px); }

    @media (max-width: 480px) {
      header.row { justify-content: center; }
    }
    .max:fullscreen {
      width: 100%; height: 100%; max-width: none;
      overflow-y: auto; display: flex; flex-direction: column;
      background: var(--bg); 
    }
    .max:fullscreen .screens-wrapper {
      flex-grow: 1; display: flex; flex-direction: column;
    }
    .max:fullscreen section[hidden] {
      display: none !important;
    }
    .max:fullscreen .screen {
      flex-grow: 1; display: flex; flex-direction: column;
    }
    .max:fullscreen #screen-start .grid {
      flex-grow: 1; display: flex; align-items: center;
    }
    .max:fullscreen .difficulty-row {
      justify-content: center;
      font-size: clamp(20px, 3vw, 24px);
    }
    .max:fullscreen .stage {
      flex-grow: 1; min-height: 0; display: flex;
      align-items: center; justify-content: center;
    }
    .max:fullscreen .stage img {
      max-width: 100%; max-height: 100%; object-fit: contain;
    }
  </style>
</head>
<body>
<div class="max">
  <header class="row">
    <h1 class="headline">1차시 | 사진 나라의 수상한 단서 찾기: 진짜와 다른 점을 찾아요</h1>
    <span class="pill">전체 합계: 찾은 단서 <b id="stat-found">0</b> · 전체 사용 시간 <b id="stat-time">00:00</b></span>
    <span class="grow"></span>
    <button id="btn-fullscreen" class="ghost">🖼️ 전체화면</button>
    <button id="btn-audio" class="ghost">🔈 음성 OFF</button>
  </header>

  <main class="screens-wrapper">
    <section id="screen-start" class="screen card" role="region" aria-label="시작 화면">
      <div class="row">
        <h2 style="margin:0">난이도 선택</h2>
      </div>
      <div class="row difficulty-row" style="margin-top:6px">
        <span class="pill">난이도</span>
        <label><input type="radio" name="diff" value="easy" checked> 쉬움</label>
        <label><input type="radio" name="diff" value="normal"> 보통</label>
        <label><input type="radio" name="diff" value="hard"> 어려움</label>
        <span class="grow"></span>
      </div>
      <div class="grid" id="grid" style="margin-top:16px"></div>
      <p class="sub" id="policy-line">
        이 활동은 <b>사진 속 실제와 다른 단서</b>를 찾아보며,  
        <b>사진이 실제와 다르게 바뀔 수 있음을 배우고 설명</b>할 수 있도록 돕습니다.<br>
        찾아낸 내용을 통해 비판적으로 생각하는 힘을 기르고,<br>
        디지털 자료를 사용할 때는 <b>허락받기·확인하기·시간 지키기</b> 약속을 실천합니다.  
        <br>
        이 웹앱은 <b>개인 정보를 수집·저장하지 않습니다.</b>  <br>
        공유할 때에는 반드시 <b>출처 표기와 사실 확인</b>을 함께 지켜주세요.
      </p>
    </section>

    <section id="screen-play" class="screen card" role="region" aria-label="플레이 화면" hidden>
      <div class="row">
        <h2 id="play-title" style="margin:0">플레이</h2>
        <span class="grow"></span>
        <button id="btn-exit" class="ghost">← 처음 화면으로 돌아가기</button>
      </div>
      <div class="sub" id="play-caption">화면에서 단서 3곳을 찾아 클릭하세요.</div>
      <div id="stage" class="stage" tabindex="0" aria-label="단서를 찾는 영역"></div>
      <div class="row" style="margin-top:12px">
        <span class="pill">찾은 단서: <b class="found-count">0</b>/<b class="need-count">0</b></span>
        <span class="pill">소요 시간: <b id="clock">00:00</b></span>
        <span class="grow"></span>
        <button id="btn-hint" class="ghost">💡 힌트 보기</button>
      </div>
      <div id="result" hidden>
        <div class="divider"></div>
        <h3 class="kudos">🎉 진짜 모습 확인 완료!</h3>
        <p class="sub" id="summary">오늘의 발견:</p>
        <div id="original" class="stage" style="margin-top:10px"></div>
        <div class="row" style="margin-top:12px">
          <button id="btn-replay" class="btn">다시하기</button>
          <button id="btn-other" class="ghost">다른 콘텐츠</button>
        </div>
      </div>
    </section>
  </main>

  <footer>제작자: 김혜인 · 문의: <a href="mailto:hyein_1221@hanmail.net">hyein_1221@hanmail.net</a></footer>
</div>

<div id="toast" class="toast" role="status" aria-live="polite" hidden></div>
<div id="confetti" class="confetti" aria-hidden="true"></div>

<script>
function speak(text){
  if(!GLOBAL.audio) return;
  try{
    const u=new SpeechSynthesisUtterance(text);
    u.lang='ko-KR';
    u.rate = 1; u.pitch = 1.3;
    const voices = speechSynthesis.getVoices();
    const ko = voices.find(v => v.lang.startsWith('ko'));
    if(ko) u.voice = ko;
    speechSynthesis.cancel();
    speechSynthesis.speak(u);
  }catch(e){}
}
</script>

<script>
  const CONTENT = {
  easy: [
    { id:'p-e-1', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy1-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy1-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy1-orig.png', need:3, spots:[{x:24,y:36,r:6},{x:52,y:62,r:6},{x:78,y:28,r:6}] },
    { id:'p-e-2', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy2-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy2-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy2-orig.png', need:3, spots:[{x:30,y:48,r:6},{x:61,y:50,r:6},{x:82,y:70,r:6}] },
    { id:'p-e-3', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy3-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy3-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy3-orig.png', need:3, spots:[{x:22,y:24,r:6},{x:50,y:58,r:6},{x:76,y:44,r:6}] }
  ],
  normal:[
    { id:'p-n-1', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal1-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal1-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal1-orig.png', need:3, spots:[{x:18,y:36,r:5},{x:47,y:42,r:5},{x:79,y:63,r:5}] },
    { id:'p-n-2', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal2-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal2-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal2-orig.png', need:3, spots:[{x:26,y:33,r:5},{x:55,y:51,r:5},{x:80,y:22,r:5}] },
    { id:'p-n-3', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal3-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal3-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal3-orig.png', need:3, spots:[{x:20,y:60,r:5},{x:48,y:35,r:5},{x:75,y:48,r:5}] }
  ],
  hard:[
    { id:'p-h-1', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard1-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard1-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard1-orig.png', need:3, spots:[{x:24,y:44,r:5},{x:56,y:40,r:5},{x:81,y:64,r:5}] },
    { id:'p-h-2', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard2-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard2-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard2-orig.png', need:3, spots:[{x:28,y:28,r:5},{x:49,y:53,r:5},{x:70,y:34,r:5}] },
    { id:'p-h-3', title:'', thumb:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard3-fake.png', fake: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard3-fake.png', orig: 'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard3-orig.png', need:3, spots:[{x:22,y:22,r:5},{x:52,y:62,r:5},{x:78,y:30,r:5}] }
  ]
};
  const qs = s=>document.querySelector(s);
  const qsa = s=>[...document.querySelectorAll(s)];
  const $start = qs('#screen-start');
  const $play = qs('#screen-play');
  const $grid = qs('#grid');
  const $stage = qs('#stage');
  const $original = qs('#original');
  const $result = qs('#result');
  const $toast = qs('#toast');
  const $confetti = qs('#confetti');
  const $btnAudio = qs('#btn-audio');
  const $foundSpans = qsa('.found-count');
  const $needSpans = qsa('.need-count');
  const $clock = qs('#clock');
  const $statFound = qs('#stat-found');
  const $statTime = qs('#stat-time');
  const $playTitle = qs('#play-title');
  const $playCaption = qs('#play-caption');

  let GLOBAL = { diff:'easy', startedAt:0, timerId:null, sessionFound:0, audio:false, dev:false };
  let ROUND = { item:null, found:new Set(), need:0, lock:false };

  function speak(text){ if(!GLOBAL.audio) return; try{ const u=new SpeechSynthesisUtterance(text); u.lang='ko-KR'; speechSynthesis.cancel(); speechSynthesis.speak(u);}catch(e){} }
  function toast(msg){ $toast.textContent = msg; $toast.hidden=false; clearTimeout(toast._t); toast._t=setTimeout(()=> $toast.hidden=true, 1400); }
  function startTimer(){ GLOBAL.startedAt=Date.now(); clearInterval(GLOBAL.timerId); GLOBAL.timerId=setInterval(()=>{ const s=Math.floor((Date.now()-GLOBAL.startedAt)/1000); const mm=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); if($clock) $clock.textContent=`${mm}:${ss}`;  },250); }
  function navPlay(on){ $start.hidden=on; $play.hidden=!on; }

  qsa('input[name="diff"]').forEach(r=> r.onchange = e=>{ GLOBAL.diff = e.target.value; buildGrid(); });
  $btnAudio.onclick = ()=>{ GLOBAL.audio = !GLOBAL.audio; $btnAudio.textContent = GLOBAL.audio? '🔊 음성 ON':'🔈 음성 OFF'; };

  function buildGrid(){
    $grid.innerHTML='';
    const list = CONTENT[GLOBAL.diff];
    list.forEach(item=>{
      const d=document.createElement('div'); d.className='thumb';
      d.innerHTML=`<img alt="thumb" src="${item.thumb}" loading="lazy"><button class="ghost">시작</button>`;
      d.querySelector('button').onclick=()=> startRound(item);
      $grid.appendChild(d);
    });
  }

  function startRound(item){
    ROUND = { item, found:new Set(), need:item.need||3, lock:false };
    $result.hidden = true;
    $playTitle.textContent = `📷 사진 나라의 수상한 단서 찾기`;
    $playCaption.textContent = '화면에서 다른 부분을 찾아 클릭하세요!';
    $foundSpans.forEach(el => el.textContent = '0');
    $needSpans.forEach(el => el.textContent = ROUND.need);
    $stage.innerHTML='';
    const img = document.createElement('img'); img.src=item.fake; img.alt='플레이 이미지'; $stage.appendChild(img);
    $stage.onclick = (e)=> onStageClick(e);
    qs('#btn-hint').onclick = ()=> showHint(item);
    qs('#btn-exit').onclick = ()=> navPlay(false);
    startTimer(); navPlay(true);
  }

  function onStageClick(e){ if(ROUND.lock) return; const rect=$stage.getBoundingClientRect(); const x=((e.clientX-rect.left)/rect.width)*100; const y=((e.clientY-rect.top)/rect.height)*100; if(GLOBAL.dev){ console.log('좌표%',{x:+x.toFixed(2),y:+y.toFixed(2)}); }
    const idx=(ROUND.item.spots||[]).findIndex((h,i)=> !ROUND.found.has(i) && dist(x,y,h.x,h.y)<= (h.r||6));
    if(idx>=0){ ROUND.found.add(idx); $foundSpans.forEach(el => el.textContent = ROUND.found.size); GLOBAL.sessionFound++; $statFound.textContent=GLOBAL.sessionFound; ringAt(x,y,true); const msg = randomGood();
      speak(msg); toast(msg);
      if(ROUND.found.size>=ROUND.need){ onWin(); } }
    else{ ringAt(x,y,false); const msg = randomBad();
      speak(msg); toast(msg);
    }
  }
  function dist(x1,y1,x2,y2){ const dx=x1-x2, dy=y1-y2; return Math.hypot(dx,dy); }
  function ringAt(px,py,good){
    const m=document.createElement('div');
    m.className='hotspot'+(good?' found':'');
    m.style.left=px+'%'; m.style.top=py+'%'; m.style.opacity=1;
    m.innerHTML='<span class="ping"></span>';
    $stage.appendChild(m);
    if (!good) setTimeout(()=> m.remove(), 1500);
  }

  function showHint(item){
    const msg = '여기를 조금 더 살펴볼까요?';
    toast(msg); speak(msg);
    const i=(item.spots||[]).findIndex((_,i)=> !ROUND.found.has(i));
    if(i>=0){
      const h=item.spots[i];
      const g=document.createElement('div'); g.className='hotspot';
      g.style.left=h.x+'%'; g.style.top=h.y+'%';
      g.style.width=g.style.height=(h.r*60)+'px';
      g.style.opacity=.75; g.style.borderStyle='solid';
      $stage.appendChild(g);
      setTimeout(()=> g.remove(), 1600);
    }
  }

  function onWin(){ ROUND.lock=true; clearInterval(GLOBAL.timerId); confetti(); $result.hidden=false; const elapsed=$clock.textContent; qs('#summary').textContent=`오늘의 발견: 단서 ${ROUND.need}개를 ${elapsed} 만에 찾았어요!`;
    $original.innerHTML=''; const img=document.createElement('img'); img.src=ROUND.item.orig; img.alt='원본 사진'; $original.appendChild(img);
    qs('#btn-replay').onclick=()=> startRound(ROUND.item); qs('#btn-other').onclick=()=> navPlay(false); speak('진짜 모습 확인 완료! 멋진 탐정이에요.'); }

  function confetti(){ $confetti.innerHTML=''; const n=80; for(let i=0;i<n;i++){ const c=document.createElement('div'); c.className='chip'; c.style.left=Math.random()*100+'%'; c.style.top=(Math.random()*-20)+'px'; c.style.background=`hsl(${Math.random()*360},80%,60%)`; c.style.animationDelay=(Math.random()*0.6)+'s'; c.style.animationDuration=(0.8+Math.random()*0.8)+'s'; $confetti.appendChild(c); } }
  function randomGood(){ return pick(['정답! 잘 찾았어요','멋진 탐정이에요','정확해요! 좋은 관찰이에요']); }
  function randomBad(){ return pick(['괜찮아요, 조금 더 살펴봐요','다른 곳도 있을 수 있어요','천천히 다시 볼까요?']); }
  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  (function init(){
    buildGrid();
    
    // Developer mode
    let clickCount = 0;
    let clickTimer = null;
    qs('.headline').onclick = () => {
      clickCount++; clearTimeout(clickTimer);
      clickTimer = setTimeout(() => { clickCount = 0; }, 1000); 
      if (clickCount >= 5) {
        GLOBAL.dev = true; clickCount = 0;
        toast('✨ 개발자 모드가 활성화되었습니다.');
        console.log('Developer mode ACTIVATED.');
      }
    };

    // Fullscreen
    const $fullscreenTarget = qs('.max');
    const $btnFullscreen = qs('#btn-fullscreen');
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        if ($fullscreenTarget.requestFullscreen) { $fullscreenTarget.requestFullscreen();
        } else if ($fullscreenTarget.webkitRequestFullscreen) { $fullscreenTarget.webkitRequestFullscreen();
        } else if ($fullscreenTarget.msRequestFullscreen) { $fullscreenTarget.msRequestFullscreen(); }
        $btnFullscreen.textContent = '🖼️ 전체화면 닫기';
      } else {
        if (document.exitFullscreen) { document.exitFullscreen(); }
        $btnFullscreen.textContent = '🖼️ 전체화면';
      }
    }
    $btnFullscreen.onclick = toggleFullscreen;

    // Session timer
    const t0=Date.now();
    setInterval(()=>{
        const s=Math.floor((Date.now()-t0)/1000);
        const mm=String(Math.floor(s/60)).padStart(2,'0');
        const ss=String(s%60).padStart(2,'0');
        if($statTime) $statTime.textContent=`${mm}:${ss}`;
    },1000);
  })();
</script>
</body>
</html>
