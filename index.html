<!doctype html>
<html lang="ko">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>1차시 | 사진 나라의 수상한 단서 찾기 : 진짜와 다른 점을 찾아요</title>
<style>
  :root{
    --bg:#fff8e6;--panel:#ffffffee;--muted:#64748b;--text:#1f2937;
    --accent:#fbbf24;--accent2:#fb923c;--good:#16a34a;--bad:#ef4444;
    --ring:#f59e0b;--soft:#f8fafc;--border:#e5e7eb;
  }
  *{box-sizing:border-box} html,body{height:100%}
  body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);
      color:var(--text);font:16px/1.5 system-ui,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif}
  .max{max-width:1100px;margin:0 auto;padding:20px;display:flex;flex-direction:column;height:100%}
  .card{background:var(--panel);backdrop-filter:blur(8px);border:1px solid var(--border);
        border-radius:18px;box-shadow:0 8px 24px #00000010}
  .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
  .grow{flex:1}
  .headline{font-size:clamp(22px,3.2vw,30px);font-weight:900;margin:0}
  .sub{color:var(--muted);font-size:14px}
  .btn, .ghost{appearance:none;border:0;border-radius:18px;padding:10px 18px;font-size:18px;font-weight:800;cursor:pointer}
  header{margin-bottom:16px;flex-shrink:0}
  .btn{color:#111827;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 18px #f59e0b33}
  .ghost{background:#fff;color:var(--text);border:1px solid var(--border)}
  label{font-size:18px; cursor: pointer;}
  .screen{padding:22px}
  .screens-wrapper{flex-grow:1;min-height:0;display:flex;flex-direction:column}
  .grid{display:grid;gap:16px;grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
  .thumb{position:relative;border-radius:16px;overflow:hidden;border:1px solid var(--border);background:#fff;display:flex;flex-direction:column}
  .thumb img{width:100%;flex-grow:1;min-height:0;object-fit:contain;display:block}
  .thumb .ghost{position:absolute;right:12px;bottom:12px;padding:14px 18px;font-size:18px}
  .stage{position:relative;border-radius:18px;overflow:hidden;border:1px solid var(--border);background:var(--soft)}
  .stage img{width:100%;height:100%;object-fit:contain;display:block}

  #screen-start[hidden], #screen-play[hidden]{display:none !important}
  #screen-play:not([hidden]){display:flex;flex-direction:column;flex-grow:1}
  #screen-play:not([hidden]) .stage{flex-grow:1;min-height:0}

  /* 단서 원(정답/오답) */
  .hotspot{position:absolute;border:3px dashed var(--ring);border-radius:999px;transform:translate(-50%,-50%);
          width:72px;height:72px;pointer-events:none;opacity:0;transition:.25s}
  .hotspot.found{border-color:var(--good);box-shadow:0 0 0 6px #16a34a33}
  .ping{position:absolute;inset:0;border-radius:inherit;border:3px solid transparent;animation:ping 1.1s ease-out 2}
  @keyframes ping{0%{box-shadow:0 0 0 0 #f59e0b55}100%{box-shadow:0 0 0 24px transparent}}

  .toast{position:fixed;left:50%;bottom:26px;transform:translateX(-50%);
        background:#111827e6;color:#fff;border:1px solid #00000022;padding:12px 16px;
        border-radius:14px;font-size:16px;z-index:9999}
  .captions{position:fixed;left:50%;top:12px;transform:translateX(-50%);
            background:#111827e6;color:#fff;padding:8px 12px;border-radius:12px;font-size:15px;z-index:9999}
  .confetti{position:fixed;inset:0;pointer-events:none}
  .chip{position:absolute;width:10px;height:10px;border-radius:2px;opacity:0;animation:fall 1.2s ease-out forwards}
  @keyframes fall{0%{transform:translateY(-20px) rotate(0);opacity:1}90%{opacity:1}100%{transform:translateY(120vh) rotate(480deg);opacity:0}}
  .divider{height:1px;background:var(--border);margin:12px 0}
  .kudos{font-weight:900;background:linear-gradient(135deg,#34d399,#fbbf24);-webkit-background-clip:text;background-clip:text;color:transparent}
  footer{margin-top:18px;text-align:center;color:#6b7280;font-size:13px;flex-shrink:0}

  /* 가독성 업: 전체화면에서 폰트/버튼 확대 */
  .difficulty-row{font-size:clamp(16px,2.5vw,20px)}
  .max:fullscreen h2{font-size:clamp(22px,3vw,28px)}
  .max:fullscreen .difficulty-row{justify-content:center;font-size:clamp(22px,3vw,28px)}
  .max:fullscreen .grid{gap:24px}
  .max:fullscreen .thumb .ghost{font-size:22px;padding:16px 22px}

  /* 플레이 화면: 스크롤 없이 한 화면에 맞춤 */
  #screen-play{flex:1;display:flex;flex-direction:column}
  #screen-play .stage{flex:1;display:flex;align-items:center;justify-content:center;max-height:70vh}
  #screen-play img{max-width:100%;max-height:100%;object-fit:contain}

  @media (max-width:480px){ header.row{justify-content:center} }
</style>
</head>
<body>
<div class="max">
  <header class="row">
    <h1 class="headline">1차시 | 사진 나라의 수상한 단서 찾기: 진짜와 다른 점을 찾아요</h1>
    <span class="pill">전체 합계: 찾은 단서 <b id="stat-found">0</b> · 전체 사용 시간 <b id="stat-time">00:00</b></span>
    <span class="grow"></span>
    <button id="btn-fullscreen" class="ghost">🖼️ 전체화면</button>
    <button id="btn-audio" class="ghost">🔈 음성 OFF</button>
  </header>

  <main class="screens-wrapper">
    <section id="screen-start" class="screen card" role="region" aria-label="시작 화면">
      <div class="row">
        <h2 style="margin:0">카테고리 선택</h2>
        <span class="grow"></span>
        <button id="btn-reset" class="ghost" title="진행 기록 초기화">처음부터 도전하기</button>
      </div>

      <div class="row difficulty-row" style="margin-top:6px">
        <span class="pill">카테고리</span>
        <label><input type="radio" name="category" value="landscape" checked> 풍경</label>
        <label><input type="radio" name="category" value="animal"> 동물</label>
        <label><input type="radio" name="category" value="object"> 사물</label>
        <span class="grow"></span>
      </div>

      <div class="grid" id="grid" style="margin-top:16px"></div>

      <p class="sub" id="policy-line" style="margin-top:12px">
        ＊ 이 활동은 <b>사진 속 실제와 다른 단서</b>를 찾아보며,
        <b>사진이 실제와 다르게 바뀔 수 있음을 배우고 설명</b>할 수 있도록 돕습니다.<br>
        ＊ 찾아낸 내용을 통해 비판적으로 생각하는 힘을 기르고, 디지털 자료를 사용할 때는
        <b>허락받기·확인하기·시간 지키기</b> 약속을 실천합니다.<br>
        ＊ 이 웹앱은 <b>개인 정보를 수집·저장하지 않습니다.</b><br>
        ＊ 공유할 때에는 반드시 <b>출처 표기와 사실 확인</b>을 함께 지켜주세요.
      </p>
    </section>

    <section id="screen-play" class="screen card" role="region" aria-label="플레이 화면" hidden>
      <div class="row">
        <h2 id="play-title" style="margin:0">플레이</h2>
        <span class="grow"></span>
        <button id="btn-exit" class="ghost">← 처음 화면으로 돌아가기</button>
      </div>

      <div class="sub" id="play-caption">틀린 점 1곳을 찾아 클릭해요!</div>
      <div id="stage" class="stage" tabindex="0" aria-label="단서를 찾는 영역"></div>

      <div class="row" style="margin-top:12px">
        <span class="pill">찾은 단서: <b class="found-count">0</b>/<b class="need-count">0</b></span>
        <span class="pill">소요 시간: <b id="clock">00:00</b></span>
        <span class="grow"></span>
        <button id="btn-hint" class="ghost">💡 힌트 보기</button>
      </div>

      <div id="result" hidden>
        <div class="divider"></div>
        <h3 class="kudos">🎉 진짜 모습 확인 완료!</h3>
        <p class="sub" id="summary">오늘의 발견:</p>
        <div id="original" class="stage" style="margin-top:10px"></div>
        <div class="row" style="margin-top:12px">
          <button id="btn-replay" class="btn" hidden>다시하기</button>
          <button id="btn-other" class="ghost">다음 단계 →</button>
        </div>
      </div>
    </section>
  </main>

  <footer>제작자: 김혜인 · 문의: <a href="mailto:hyein_1221@hanmail.net">hyein_1221@hanmail.net</a></footer>
</div>

<div id="captions" class="captions" hidden></div>
<div id="toast" class="toast" role="status" aria-live="polite" hidden></div>
<div id="confetti" class="confetti" aria-hidden="true"></div>

<script>
/* ---------- 음성 & 자막 ---------- */
function showCaption(msg){
  const c = document.getElementById('captions');
  c.textContent = msg; c.hidden = false;
  clearTimeout(showCaption._t);
  showCaption._t = setTimeout(()=> c.hidden = true, 1400);
}
function speak(text){
  if(!GLOBAL.audio){ showCaption(text); return; }
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang='ko-KR'; u.rate=1; u.pitch=1.15;
    const apply=()=>{
      const ko = speechSynthesis.getVoices().find(v=>v.lang.startsWith('ko'));
      if(ko) u.voice = ko;
      speechSynthesis.cancel(); speechSynthesis.speak(u);
    };
    if(!speechSynthesis.getVoices().length){ speechSynthesis.onvoiceschanged = apply; }
    else apply();
  }catch(e){}
  showCaption(text);
}
</script>

<script>
/* ---------- 콘텐츠(이미지 경로 포함) ---------- */
const CONTENT = {
  landscape: [
    { id:'l-1',
      fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-landscape-1.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-landscape-1.jpg',
      need:1, spots:[{x:28.8,y:43.4,r:7}] },
    { id:'l-2',
      fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-landscape-2.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-landscape-2.jpg',
      need:1, spots:[{x:66.1,y:83.7,r:7}] },
    { id:'l-3',
      fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-landscape-3.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-landscape-3.jpg',
      need:1, spots:[{x:19.8,y:48.5,r:7},{x:49.7,y:47,r:7},{x:86.6,y:49.5,r:7}] }
  ],
  animal: [
    { id:'a-1', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-animal-1.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-animal-1.jpg',
      need:1, spots:[{x:24.6,y:43.2,r:7},{x:42.4,y:40.2,r:7},{x:54.9,y:44.3,r:7},{x:70.0,y:42.4,r:7}] },
    { id:'a-2', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-animal-2.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-animal-2.jpg',
      need:1, spots:[{x:48.3,y:58.1,r:7},{x:44.1,y:71.4,r:7}] },
    { id:'a-3', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-animal-3.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-animal-3.png',
      need:1, spots:[{x:43.3,y:69.7,r:7}] }
  ],
  object: [
    { id:'o-1', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-object-1.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-object-1.jpg',
      need:1, spots:[{x:35.8,y:54,r:7},{x:59.5,y:54,r:7}] },
    { id:'o-2', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-object-2.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-object-2.jpg',
      need:1, spots:[{x:36.7,y:90.1,r:7},{x:55.4,y:91.4,r:7},{x:78.8,y:88.4,r:7}] },
    { id:'o-3', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/ai-object-3.png',
      orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/og-object-3.jpg',
      need:1, spots:[{x:27,y:82.2,r:7},{x:72.9,y:84.0,r:7}] }
  ]
};
</script>

<script>
/* ---------- 전역 상태/유틸 ---------- */
const qs = s=>document.querySelector(s);
const qsa = s=>[...document.querySelectorAll(s)];
const $start = qs('#screen-start');
const $play  = qs('#screen-play');
const $grid  = qs('#grid');
const $stage = qs('#stage');
const $original = qs('#original');
const $result   = qs('#result');
const $toast    = qs('#toast');
const $confetti = qs('#confetti');
const $btnAudio = qs('#btn-audio');
const $foundSpans = qsa('.found-count');
const $needSpans  = qsa('.need-count');
const $clock = qs('#clock');
const $statFound = qs('#stat-found');
const $statTime  = qs('#stat-time');
const $playTitle = qs('#play-title');
const $playCaption = qs('#play-caption');
const $btnReset = qs('#btn-reset');

let GLOBAL = { category:'landscape', startedAt:0, timerId:null, sessionFound:0, audio:false, dev:false, cleared:{} };
let ROUND  = { step:0, item:null, found:new Set(), need:0, lock:false };

const STORAGE_KEY = 'cleared_categories_v1';
function loadClears(){ try{ return JSON.parse(localStorage.getItem(STORAGE_KEY)||'{}'); }catch(e){ return {}; } }
function saveClears(){ localStorage.setItem(STORAGE_KEY, JSON.stringify(GLOBAL.cleared||{})); }

/* 라디오에 클리어(✅) 반영/해제 + 선택 자동 보정 */
function applyClearsToUI(reset=false){
  const order = ['landscape','animal','object'];
  let selectionChanged = false;

  order.forEach(cat=>{
    const input = document.querySelector(`input[name="category"][value="${cat}"]`);
    if(!input) return;
    const label = input.parentElement;

    // 기존 " ✅" 텍스트 노드 찾아서 제거 (innerHTML을 건드리지 않는 안전한 방식)
    label.childNodes.forEach(node => {
        if(node.nodeType === Node.TEXT_NODE && node.textContent.includes('✅')){
            node.textContent = node.textContent.replace(' ✅','');
        }
    });

    if(!reset && GLOBAL.cleared[cat]){
      input.disabled = true;
      if (input.checked) { input.checked = false; selectionChanged = true; }
      label.appendChild(document.createTextNode(' ✅')); // HTML을 새로 그리지 않고 텍스트만 추가
    }else{
      input.disabled = false;
    }
  });

  const nowChecked = document.querySelector('input[name="category"]:checked');
  if (!nowChecked){
    const next = order.find(c => !GLOBAL.cleared[c]);
    const fallback = next || order[0];
    const pick = document.querySelector(`input[name="category"][value="${fallback}"]`);
    if (pick){
      pick.checked = true;
      GLOBAL.category = pick.value;
      selectionChanged = true;
    }
  } else {
    GLOBAL.category = nowChecked.value;
  }
  return selectionChanged;
}

function speakToast(msg){ speak(msg); toast(msg); }
function toast(msg){ $toast.textContent=msg; $toast.hidden=false; clearTimeout(toast._t);
  toast._t=setTimeout(()=> $toast.hidden=true, 1400); }

function startTimer(){
  GLOBAL.startedAt = Date.now();
  clearInterval(GLOBAL.timerId);
  GLOBAL.timerId = setInterval(()=>{
    const s = Math.floor((Date.now()-GLOBAL.startedAt)/1000);
    const mm=String(Math.floor(s/60)).padStart(2,'0');
    const ss=String(s%60).padStart(2,'0');
    if($clock) $clock.textContent=`${mm}:${ss}`;
  }, 250);
}
function navPlay(on){ $start.hidden = on; $play.hidden = !on; }

/* ---------- UI 빌드 & 진행 ---------- */
qsa('input[name="category"]').forEach(r=> r.onchange = e=>{
  if (e.target.disabled) return;
  GLOBAL.category = e.target.value;
  buildGrid();
});

$btnAudio.onclick = ()=>{
  GLOBAL.audio = !GLOBAL.audio;
  $btnAudio.textContent = GLOBAL.audio? '🔊 음성 ON' : '🔈 음성 OFF';
};

function buildGrid(){
  $grid.innerHTML='';
  const cat = GLOBAL.category;
  if (!CONTENT[cat] || !CONTENT[cat][0]) {
    console.error(`'${cat}' 카테고리에 대한 콘텐츠가 없습니다.`);
    return;
  }
  const first = CONTENT[cat][0];
  const d = document.createElement('div');
  d.className = 'thumb';
  const catLabel = (cat==='landscape'?'풍경':cat==='animal'?'동물':'사물');
  d.innerHTML = `<img alt="${cat}-thumb" src="${first.fake}" loading="lazy">
                   <button class="ghost">${catLabel} 1단계 시작</button>`;
  d.querySelector('button').onclick = ()=> startCategory(cat);
  $grid.appendChild(d);
  applyClearsToUI();
}

function startCategory(cat){
  GLOBAL.category = cat;
  ROUND = { step:0, item:null, found:new Set(), need:0, lock:false };
  playStep();
}

function playStep(){
  const items = CONTENT[GLOBAL.category];
  if(ROUND.step >= items.length){ showCategoryClear(GLOBAL.category); return; }

  const item = items[ROUND.step];
  ROUND.item = item; ROUND.found=new Set(); ROUND.need=item.need||1; ROUND.lock=false;

  $result.hidden = true;
  const catLabel = (GLOBAL.category==='landscape'?'풍경':GLOBAL.category==='animal'?'동물':'사물');
  $playTitle.textContent = `📷 ${catLabel} ${ROUND.step+1}단계`;
  $playCaption.textContent = '틀린 점 1곳을 찾아 클릭해요!';
  $foundSpans.forEach(el=> el.textContent='0');
  $needSpans.forEach(el=> el.textContent=ROUND.need);

  $stage.innerHTML='';
  const img=document.createElement('img');
  img.src=item.fake; img.alt='플레이 이미지';
  $stage.appendChild(img);

  $stage.onclick = onStageClick;
  qs('#btn-hint').onclick = ()=> showHint(item);
  qs('#btn-exit').onclick = ()=> navPlay(false);

  startTimer(); navPlay(true);
}

function onStageClick(e){
  if(ROUND.lock) return;
  const rect=$stage.getBoundingClientRect();
  const x=((e.clientX-rect.left)/rect.width)*100;
  const y=((e.clientY-rect.top)/rect.height)*100;
 if (GLOBAL.dev) {
    console.log(`[개발자 모드] x: ${x.toFixed(1)}, y: ${y.toFixed(1)}`);
  }
  const idx=(ROUND.item.spots||[]).findIndex((h,i)=> !ROUND.found.has(i) &&
    Math.hypot(x-h.x,y-h.y) <= (h.r||6) + 5);
  
  if(idx>=0){
    ROUND.found.add(idx);
    $foundSpans.forEach(el=> el.textContent = ROUND.found.size);
    GLOBAL.sessionFound++; $statFound.textContent = GLOBAL.sessionFound;
    ringAt(x,y,true);
    speakToast('정답! 잘 찾았어요');
    if(ROUND.found.size>=ROUND.need){ onWin(); }
  }else{
    ringAt(x,y,false); speakToast('괜찮아요, 조금 더 살펴봐요');
  }
}
function ringAt(px,py,good){
  const m=document.createElement('div');
  m.className='hotspot'+(good?' found':'');
  m.style.left=px+'%'; m.style.top=py+'%'; m.style.opacity=1;
  m.innerHTML='<span class="ping"></span>';
  $stage.appendChild(m);
  if(!good) setTimeout(()=> m.remove(), 1500);
}

function showHint(item){
  const msg='여기를 조금 더 살펴볼까요?';
  speakToast(msg);
  const i=(item.spots||[]).findIndex((_,i)=> !ROUND.found.has(i));
  if(i>=0){
    const h=item.spots[i];
    const g=document.createElement('div'); g.className='hotspot';
    g.style.left=h.x+'%'; g.style.top=h.y+'%';
    g.style.width=g.style.height=(h.r*60)+'px';
    g.style.opacity=.75; g.style.borderStyle='solid';
    $stage.appendChild(g);
    setTimeout(()=> g.remove(), 1600);
  }
}

function onWin(){
  ROUND.lock=true; clearInterval(GLOBAL.timerId); confetti();
  $result.hidden=false;
  const elapsed=$clock.textContent;
  qs('#summary').textContent = `오늘의 발견: ${ROUND.step+1}단계 단서 ${ROUND.need}개를 ${elapsed} 만에 찾았어요!`;

  $original.innerHTML='';
  const img=document.createElement('img');
  img.src=ROUND.item.orig; img.alt='원본 사진';
  $original.appendChild(img);

  const last = ROUND.step >= CONTENT[GLOBAL.category].length-1;
  const $next = qs('#btn-other');
  $next.textContent = last ? '홈으로' : '다음 단계 →';
  $next.onclick = ()=>{
    if(last){
        showCategoryClear(GLOBAL.category);
        navPlay(false);
    }
    else { ROUND.step += 1; $result.hidden=true; playStep(); }
  };

  speak(last ? '진짜 모습 확인 완료! 전부 다 찾았어요!' : '진짜 모습 확인 완료! 다음 단계로 가볼까요?');
}

function showCategoryClear(cat){
  GLOBAL.cleared[cat] = true; saveClears();
  const label = (cat==='landscape'?'풍경':cat==='animal'?'동물':'사물');
  speakToast(`${label} 클리어! 참 잘했어요 👏`);

  const order=['landscape','animal','object'];
  const next = order.find(c=>!GLOBAL.cleared[c]);
  if(next){
    GLOBAL.category = next;
    const r = document.querySelector(`input[name="category"][value="${next}"]`);
    if(r) r.checked = true;
  } else {
    const firstRadio = document.querySelector(`input[name="category"][value="${order[0]}"]`);
    if (firstRadio) {
      firstRadio.checked = true;
      GLOBAL.category = order[0];
    }
  }
  applyClearsToUI();
  buildGrid();
}

/* ---------- 이펙트/보조 ---------- */
function confetti(){
  $confetti.innerHTML='';
  for(let i=0;i<80;i++){
    const c=document.createElement('div'); c.className='chip';
    c.style.left=Math.random()*100+'%';
    c.style.top=(Math.random()*-20)+'px';
    c.style.background=`hsl(${Math.random()*360},80%,60%)`;
    c.style.animationDelay=(Math.random()*0.6)+'s';
    c.style.animationDuration=(0.8+Math.random()*0.8)+'s';
    $confetti.appendChild(c);
  }
}
function randomGood(){return ['정답! 잘 찾았어요','멋진 탐정이에요','정확해요! 좋은 관찰이에요'][Math.floor(Math.random()*3)]}
function randomBad(){return ['괜찮아요, 조금 더 살펴봐요','다른 곳도 있을 수 있어요','천천히 다시 볼까요?'][Math.floor(Math.random()*3)]}

/* ---------- 초기화/전체화면/세션타이머 ---------- */
(function init(){
  GLOBAL.cleared = loadClears();
  
  const hasSelection = document.querySelector('input[name="category"]:checked');
  if (!hasSelection || GLOBAL.cleared[hasSelection.value]) {
    applyClearsToUI(); 
  } else {
    GLOBAL.category = hasSelection.value;
  }
  
  buildGrid();

  // 개발자 모드(헤드라인 5연속 클릭)
  let clickCount=0, clickTimer=null;
  qs('.headline').onclick = ()=>{
    clickCount++; clearTimeout(clickTimer);
    clickTimer=setTimeout(()=>clickCount=0,1000);
    if(clickCount>=5){ GLOBAL.dev=true; clickCount=0; toast('✨ 개발자 모드 ON'); }
  };

  // 전체화면
  const $fullscreenTarget = qs('.max');
  qs('#btn-fullscreen').onclick = ()=>{
    if(!document.fullscreenElement){
      ($fullscreenTarget.requestFullscreen||$fullscreenTarget.webkitRequestFullscreen||$fullscreenTarget.msRequestFullscreen).call($fullscreenTarget);
      qs('#btn-fullscreen').textContent='🖼️ 전체화면 닫기';
    }else{
      document.exitFullscreen && document.exitFullscreen();
      qs('#btn-fullscreen').textContent='🖼️ 전체화면';
    }
  };

  // 화면 상단 전체 사용 시간(세션 유지)
  let t0 = sessionStorage.getItem('sessionStartTime');
  if(!t0){ t0=Date.now(); sessionStorage.setItem('sessionStartTime', t0); }
  setInterval(()=>{
    const s=Math.floor((Date.now()-t0)/1000);
    const mm=String(Math.floor(s/60)).padStart(2,'0');
    const ss=String(s%60).padStart(2,'0');
    if($statTime) $statTime.textContent=`${mm}:${ss}`;
  },1000);

  // “처음부터 도전하기”
  if($btnReset){
    $btnReset.onclick = ()=>{
      if (confirm('모든 진행 기록을 지우고 처음부터 다시 시작할까요?')) {
        localStorage.removeItem(STORAGE_KEY);
        GLOBAL.cleared = {};
        applyClearsToUI(true);
        GLOBAL.category='landscape';
        const r=document.querySelector('input[name="category"][value="landscape"]');
        if(r) r.checked = true;
        buildGrid();
        speakToast('진행 기록이 초기화되었습니다. 처음부터 다시 도전해요!');
      }
    };
  }
})();
</script>
</body>
</html>
