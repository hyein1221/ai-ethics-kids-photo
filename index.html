<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>1ì°¨ì‹œ | ì‚¬ì§„ ë‚˜ë¼ì˜ ìˆ˜ìƒí•œ ë‹¨ì„œ ì°¾ê¸° : ì§„ì§œì™€ ë‹¤ë¥¸ ì ì„ ì°¾ì•„ìš”</title>
  <style>
    :root{
      --bg:#fff8e6;--panel:#ffffffee;--muted:#64748b;--text:#1f2937;--accent:#fbbf24;--accent2:#fb923c;--good:#16a34a;--bad:#ef4444;--ring:#f59e0b;--soft:#f8fafc;--border:#e5e7eb;
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{margin:0;background:linear-gradient(180deg,var(--bg),#fff);color:var(--text);font:16px/1.5 system-ui,Segoe UI,Apple SD Gothic Neo,Noto Sans KR,Arial,sans-serif}
    .max{max-width:1100px;margin:0 auto;padding:20px;display:flex;flex-direction:column;height:100%;}
    .card{background:var(--panel);backdrop-filter:blur(8px);border:1px solid var(--border);border-radius:18px;box-shadow:0 8px 24px #00000010}
    .row{display:flex;gap:12px;align-items:center;flex-wrap:wrap}
    .grow{flex:1}
    .headline{font-size:clamp(22px,3.2vw,30px);font-weight:900;margin:0}
    .sub{color:var(--muted);font-size:14px}
    .btn, .ghost{appearance:none;border:0;border-radius:18px;padding:10px 18px;font-size:18px;font-weight:800;cursor:pointer}
    header {margin-bottom: 16px; flex-shrink: 0;}
    .btn{color:#111827;background:linear-gradient(135deg,var(--accent),var(--accent2));box-shadow:0 8px 18px #f59e0b33}
    .ghost{background:#fff;color:var(--text);border:1px solid var(--border)}
    label{font-size:18px}
    .screen{padding:22px}
    .screens-wrapper { flex-grow: 1; min-height: 0; display: flex; flex-direction: column; }
    .grid { display: grid; gap: 16px; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); }
    .thumb{position:relative;border-radius:16px;overflow:hidden;border:1px solid var(--border);background:#fff;display:flex;flex-direction:column;}
    .thumb img{width:100%;flex-grow:1;min-height:0;object-fit:contain;display:block}
    .thumb .ghost{position:absolute;right:12px;bottom:12px;padding:14px 18px;font-size:18px}
    .stage{position:relative;border-radius:18px;overflow:hidden;border:1px solid var(--border);background:var(--soft);}
    .stage img{width:100%;height:100%;object-fit:contain;display:block}
   #screen-start[hidden],
#screen-play[hidden] {
  display: none !important;
}

/* ë³´ì¼ ë•Œë§Œ flex ë°°ì¹˜ */
#screen-play:not([hidden]) { 
  display: flex; 
  flex-direction: column; 
  flex-grow: 1; 
}

#screen-play:not([hidden]) .stage { 
  flex-grow: 1; 
  min-height: 0; 
}

/* ë‹¨ì„œ ì› í‘œì‹œ */
.hotspot {
  position:absolute;
  border:3px dashed var(--ring);
  border-radius:999px;
  transform:translate(-50%,-50%);
  width:72px; height:72px;
  pointer-events:none;
  opacity:0;
  transition:.25s
}
.hotspot.found {
  border-color:var(--good);
  box-shadow:0 0 0 6px #16a34a33
}
    .ping{position:absolute;inset:0;border-radius:inherit;border:3px solid transparent;animation:ping 1.1s ease-out 2}
    @keyframes ping{0%{box-shadow:0 0 0 0 #f59e0b55}100%{box-shadow:0 0 0 24px transparent}}
   .toast{
      position:fixed;
      left:50%; bottom:26px;
      transform:translateX(-50%);
      background:#111827e6;
      color:#fff;
      border:1px solid #00000022;
      padding:12px 16px;
      border-radius:14px;
      font-size:16px;
      z-index:9999;
    }
    .confetti{position:fixed;inset:0;pointer-events:none}
    .chip{position:absolute;width:10px;height:10px;border-radius:2px;opacity:0;animation:fall 1.2s ease-out forwards}
    @keyframes fall{0%{transform:translateY(-20px) rotate(0);opacity:1}90%{opacity:1}100%{transform:translateY(120vh) rotate(480deg);opacity:0}}
    .divider{height:1px;background:var(--border);margin:12px 0}
    .kudos{font-weight:900;color:#111827;background:linear-gradient(135deg,#34d399,#fbbf24);-webkit-background-clip:text;background-clip:text;color:transparent}
    footer{margin-top:18px;text-align:center;color:#6b7280;font-size:13px; flex-shrink: 0;}
   .difficulty-row { 
  font-size: clamp(16px, 2.5vw, 20px); 
}

.max:fullscreen h2 {
  font-size: clamp(22px, 3vw, 28px);
}

.max:fullscreen .difficulty-row {
  justify-content: center;
  font-size: clamp(22px, 3vw, 28px);
}

.max:fullscreen .grid {
  gap: 24px;
}

.max:fullscreen .thumb .ghost {
  font-size: 22px;
  padding: 16px 22px;
}

@media (max-width: 480px) {
  header.row { justify-content: center; }
}

.max:fullscreen {
  width: 100%; height: 100%; max-width: none;
  overflow-y: auto; display: flex; flex-direction: column;
  background: var(--bg); 
}

.max:fullscreen .screens-wrapper {
  flex-grow: 1; display: flex; flex-direction: column;
}

.max:fullscreen section[hidden] {
  display: none !important;
}

.max:fullscreen .screen {
  flex-grow: 1; display: flex; flex-direction: column;
}

.max:fullscreen #screen-start .grid {
  flex-grow: 1; display: flex; align-items: center;
}

.max:fullscreen .stage {
  flex-grow: 1; min-height: 0; display: flex;
  align-items: center; justify-content: center;
}

.max:fullscreen .stage img {
  max-width: 100%; max-height: 100%; object-fit: contain;
}

#screen-play {
  flex: 1;
  display: flex;
  flex-direction: column;
}

#screen-play .stage {
  flex: 1;
  display: flex;
  align-items: center;
  justify-content: center;
  max-height: 70vh; /* í™”ë©´ì˜ 70%ê¹Œì§€ë§Œ */
}

#screen-play img {
  max-width: 100%;
  max-height: 100%;
  object-fit: contain;
}
</style>
</head>
<body>
<div class="max">
  <header class="row">
    <h1 class="headline">1ì°¨ì‹œ | ì‚¬ì§„ ë‚˜ë¼ì˜ ìˆ˜ìƒí•œ ë‹¨ì„œ ì°¾ê¸°: ì§„ì§œì™€ ë‹¤ë¥¸ ì ì„ ì°¾ì•„ìš”</h1>
    <span class="pill">ì „ì²´ í•©ê³„: ì°¾ì€ ë‹¨ì„œ <b id="stat-found">0</b> Â· ì „ì²´ ì‚¬ìš© ì‹œê°„ <b id="stat-time">00:00</b></span>
    <span class="grow"></span>
    <button id="btn-fullscreen" class="ghost">ğŸ–¼ï¸ ì „ì²´í™”ë©´</button>
    <button id="btn-audio" class="ghost">ğŸ”ˆ ìŒì„± OFF</button>
  </header>

  <main class="screens-wrapper">
    <section id="screen-start" class="screen card" role="region" aria-label="ì‹œì‘ í™”ë©´">
           <div class="row">
        <h2 style="margin:0">ì¹´í…Œê³ ë¦¬ ì„ íƒ</h2>
      </div>
      <div class="row difficulty-row" style="margin-top:6px">
        <span class="pill">ì¹´í…Œê³ ë¦¬</span>
        <label><input type="radio" name="category" value="landscape" checked> í’ê²½</label>
        <label><input type="radio" name="category" value="animal"> ë™ë¬¼</label>
        <label><input type="radio" name="category" value="food"> ìŒì‹</label>
        <span class="grow"></span>
      </div>

      <div class="grid" id="grid" style="margin-top:16px"></div>
      <p class="sub" id="policy-line">
        ï¼Š ì´ í™œë™ì€ <b>ì‚¬ì§„ ì† ì‹¤ì œì™€ ë‹¤ë¥¸ ë‹¨ì„œ</b>ë¥¼ ì°¾ì•„ë³´ë©°,  
        <b>ì‚¬ì§„ì´ ì‹¤ì œì™€ ë‹¤ë¥´ê²Œ ë°”ë€” ìˆ˜ ìˆìŒì„ ë°°ìš°ê³  ì„¤ëª…</b>í•  ìˆ˜ ìˆë„ë¡ ë•ìŠµë‹ˆë‹¤.<br>
        ï¼Š ì°¾ì•„ë‚¸ ë‚´ìš©ì„ í†µí•´ ë¹„íŒì ìœ¼ë¡œ ìƒê°í•˜ëŠ” í˜ì„ ê¸°ë¥´ê³ ,ë””ì§€í„¸ ìë£Œë¥¼ ì‚¬ìš©í•  ë•ŒëŠ” <b>í—ˆë½ë°›ê¸°Â·í™•ì¸í•˜ê¸°Â·ì‹œê°„ ì§€í‚¤ê¸°</b> ì•½ì†ì„ ì‹¤ì²œí•©ë‹ˆë‹¤.  
        <br>
        ï¼Š ì´ ì›¹ì•±ì€ <b>ê°œì¸ ì •ë³´ë¥¼ ìˆ˜ì§‘Â·ì €ì¥í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.</b>  <br>
        ï¼Š ê³µìœ í•  ë•Œì—ëŠ” ë°˜ë“œì‹œ <b>ì¶œì²˜ í‘œê¸°ì™€ ì‚¬ì‹¤ í™•ì¸</b>ì„ í•¨ê»˜ ì§€ì¼œì£¼ì„¸ìš”.
      </p>
    </section>

    <section id="screen-play" class="screen card" role="region" aria-label="í”Œë ˆì´ í™”ë©´" hidden>
      <div class="row">
        <h2 id="play-title" style="margin:0">í”Œë ˆì´</h2>
        <span class="grow"></span>
        <button id="btn-exit" class="ghost">â† ì²˜ìŒ í™”ë©´ìœ¼ë¡œ ëŒì•„ê°€ê¸°</button>
      </div>
      <div class="sub" id="play-caption">í™”ë©´ì—ì„œ ë‹¨ì„œ 3ê³³ì„ ì°¾ì•„ í´ë¦­í•˜ì„¸ìš”.</div>
      <div id="stage" class="stage" tabindex="0" aria-label="ë‹¨ì„œë¥¼ ì°¾ëŠ” ì˜ì—­"></div>
      <div class="row" style="margin-top:12px">
        <span class="pill">ì°¾ì€ ë‹¨ì„œ: <b class="found-count">0</b>/<b class="need-count">0</b></span>
        <span class="pill">ì†Œìš” ì‹œê°„: <b id="clock">00:00</b></span>
        <span class="grow"></span>
        <button id="btn-hint" class="ghost">ğŸ’¡ íŒíŠ¸ ë³´ê¸°</button>
      </div>
      <div id="result" hidden>
        <div class="divider"></div>
        <h3 class="kudos">ğŸ‰ ì§„ì§œ ëª¨ìŠµ í™•ì¸ ì™„ë£Œ!</h3>
        <p class="sub" id="summary">ì˜¤ëŠ˜ì˜ ë°œê²¬:</p>
        <div id="original" class="stage" style="margin-top:10px"></div>
        <div class="row" style="margin-top:12px">
          <button id="btn-replay" class="btn">ë‹¤ì‹œí•˜ê¸°</button>
          <button id="btn-other" class="ghost">ë‹¤ë¥¸ ì½˜í…ì¸ </button>
        </div>
      </div>
    </section>
  </main>

  <footer>ì œì‘ì: ê¹€í˜œì¸ Â· ë¬¸ì˜: <a href="mailto:hyein_1221@hanmail.net">hyein_1221@hanmail.net</a></footer>
</div>

<div id="toast" class="toast" role="status" aria-live="polite" hidden></div>
<div id="confetti" class="confetti" aria-hidden="true"></div>

<script>
function showCaption(msg){
  const c = document.getElementById('captions');
  c.textContent = msg; c.hidden = false;
  clearTimeout(showCaption._t);
  showCaption._t = setTimeout(()=> c.hidden = true, 1400);
}
function speak(text){
  if(!GLOBAL.audio) { showCaption(text); return; }
  try{
    const u = new SpeechSynthesisUtterance(text);
    u.lang='ko-KR'; u.rate=1; u.pitch=1.3;
    const apply = () => {
      const ko = speechSynthesis.getVoices().find(v=>v.lang.startsWith('ko'));
      if(ko) u.voice = ko;
      speechSynthesis.cancel(); speechSynthesis.speak(u);
    };
    if (!speechSynthesis.getVoices().length) {
      speechSynthesis.onvoiceschanged = apply;
    } else apply();
  }catch(e){}
  showCaption(text);
}
</script>

<script>
   const CONTENT = {
    // í’ê²½ = ê¸°ì¡´ easy 3ì¥ (ê° ë‹¨ê³„ 1ê°œë§Œ ì°¾ê¸°)
    landscape: [
      { id:'l-1', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy1-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy1-orig.png', need:1, spots:[{x:24,y:36,r:8}] },
      { id:'l-2', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy2-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy2-orig.png', need:1, spots:[{x:61,y:50,r:8}] },
      { id:'l-3', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy3-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/easy3-orig.png', need:1, spots:[{x:50,y:58,r:8}] }
    ],
    // ë™ë¬¼ = ê¸°ì¡´ normal 3ì¥
    animal: [
      { id:'a-1', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal1-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal1-orig.png', need:1, spots:[{x:47,y:42,r:7}] },
      { id:'a-2', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal2-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal2-orig.png', need:1, spots:[{x:55,y:51,r:7}] },
      { id:'a-3', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal3-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/normal3-orig.png', need:1, spots:[{x:48,y:35,r:7}] }
    ],
    // ìŒì‹ = ê¸°ì¡´ hard 3ì¥
    food: [
      { id:'f-1', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard1-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard1-orig.png', need:1, spots:[{x:56,y:40,r:7}] },
      { id:'f-2', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard2-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard2-orig.png', need:1, spots:[{x:49,y:53,r:7}] },
      { id:'f-3', fake:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard3-fake.png', orig:'https://raw.githubusercontent.com/hyein1221/ai-ethics-kids-photo/main/images/hard3-orig.png', need:1, spots:[{x:52,y:62,r:7}] }
    ]
  };

  const qs = s=>document.querySelector(s);
  const qsa = s=>[...document.querySelectorAll(s)];
  const $start = qs('#screen-start');
  const $play = qs('#screen-play');
  const $grid = qs('#grid');
  const $stage = qs('#stage');
  const $original = qs('#original');
  const $result = qs('#result');
  const $toast = qs('#toast');
  const $confetti = qs('#confetti');
  const $btnAudio = qs('#btn-audio');
  const $foundSpans = qsa('.found-count');
  const $needSpans = qsa('.need-count');
  const $clock = qs('#clock');
  const $statFound = qs('#stat-found');
  const $statTime = qs('#stat-time');
  const $playTitle = qs('#play-title');
  const $playCaption = qs('#play-caption');

  let GLOBAL = { category:'landscape', startedAt:0, timerId:null, sessionFound:0, audio:false, dev:false, cleared:{} };
  let ROUND = { step:0, item:null, found:new Set(), need:0, lock:false };


  function speak(text){ if(!GLOBAL.audio) return; try{ const u=new SpeechSynthesisUtterance(text); u.lang='ko-KR'; speechSynthesis.cancel(); speechSynthesis.speak(u);}catch(e){} }
  function toast(msg){ $toast.textContent = msg; $toast.hidden=false; clearTimeout(toast._t); toast._t=setTimeout(()=> $toast.hidden=true, 1400); }
  function startTimer(){ GLOBAL.startedAt=Date.now(); clearInterval(GLOBAL.timerId); GLOBAL.timerId=setInterval(()=>{ const s=Math.floor((Date.now()-GLOBAL.startedAt)/1000); const mm=String(Math.floor(s/60)).padStart(2,'0'); const ss=String(s%60).padStart(2,'0'); if($clock) $clock.textContent=`${mm}:${ss}`;  },250); }
  function navPlay(on){ $start.hidden=on; $play.hidden=!on; }

  qsa('input[name="category"]').forEach(r=> r.onchange = e=>{
    GLOBAL.category = e.target.value;
    buildGrid();
  });

  $btnAudio.onclick = ()=>{ GLOBAL.audio = !GLOBAL.audio; $btnAudio.textContent = GLOBAL.audio? 'ğŸ”Š ìŒì„± ON':'ğŸ”ˆ ìŒì„± OFF'; };

   function buildGrid(){
    $grid.innerHTML='';

    // ì¹´í…Œê³ ë¦¬ë³„ ëŒ€í‘œ ì¸ë„¤ì¼(1ë‹¨ê³„ fake)ì„ ì‚¬ìš©í•´ "ì‹œì‘" 1ì¥ë§Œ ë³´ì—¬ì¤Œ
    const cat = GLOBAL.category;
    const items = CONTENT[cat];
    const first = items[0];

    const d = document.createElement('div');
    d.className = 'thumb';
    d.innerHTML = `
      <img alt="${cat}-thumb" src="${first.fake}" loading="lazy">
      <button class="ghost">${cat==='landscape'?'í’ê²½':'animal'===cat?'ë™ë¬¼':'ìŒì‹'} 1ë‹¨ê³„ ì‹œì‘</button>
    `;
    d.querySelector('button').onclick = ()=> startCategory(cat);
    $grid.appendChild(d);

    // ì´ë¯¸ í´ë¦¬ì–´í•œ ì¹´í…Œê³ ë¦¬ëŠ” ë¹„í™œì„±/ë§ˆí¬
    const input = document.querySelector(`input[name="category"][value="${cat}"]`);
    if (GLOBAL.cleared[cat] && input && !input.disabled){
      input.disabled = true;
      input.parentElement.innerHTML += ' âœ…';
    }
  }


  // ì¹´í…Œê³ ë¦¬ í”Œë ˆì´ ì‹œì‘ (step=0ë¶€í„°)
  function startCategory(cat){
    GLOBAL.category = cat;
    ROUND = { step:0, item:null, found:new Set(), need:0, lock:false };
    playStep();
  }

  // í˜„ì¬ stepì˜ ì•„ì´í…œì„ ë¶ˆëŸ¬ì™€ í”Œë ˆì´
  function playStep(){
    const items = CONTENT[GLOBAL.category];
    if (ROUND.step >= items.length){
      showCategoryClear(GLOBAL.category);
      return;
    }
    const item = items[ROUND.step];

    ROUND.item = item;
    ROUND.found = new Set();
    ROUND.need  = item.need || 1;
    ROUND.lock  = false;

    $result.hidden = true;
    $playTitle.textContent = `ğŸ“· ${GLOBAL.category==='landscape'?'í’ê²½':GLOBAL.category==='animal'?'ë™ë¬¼':'ìŒì‹'} ${ROUND.step+1}ë‹¨ê³„`;
    $playCaption.textContent = 'í‹€ë¦° ì  1ê³³ì„ ì°¾ì•„ í´ë¦­í•´ìš”!';
    $foundSpans.forEach(el => el.textContent = '0');
    $needSpans.forEach(el => el.textContent = ROUND.need);

    $stage.innerHTML='';
    const img = document.createElement('img');
    img.src = item.fake; img.alt='í”Œë ˆì´ ì´ë¯¸ì§€';
    $stage.appendChild(img);

    $stage.onclick = (e)=> onStageClick(e);
    qs('#btn-hint').onclick = ()=> showHint(item);
    qs('#btn-exit').onclick = ()=> navPlay(false);

    startTimer(); navPlay(true);
  }


  function onStageClick(e){ if(ROUND.lock) return; const rect=$stage.getBoundingClientRect(); const x=((e.clientX-rect.left)/rect.width)*100; const y=((e.clientY-rect.top)/rect.height)*100; if(GLOBAL.dev){ console.log('ì¢Œí‘œ%',{x:+x.toFixed(2),y:+y.toFixed(2)}); }
    const idx=(ROUND.item.spots||[]).findIndex((h,i)=> !ROUND.found.has(i) && dist(x,y,h.x,h.y)<= (h.r||6));
    if(idx>=0){ ROUND.found.add(idx); $foundSpans.forEach(el => el.textContent = ROUND.found.size); GLOBAL.sessionFound++; $statFound.textContent=GLOBAL.sessionFound; ringAt(x,y,true); const msg = randomGood();
      speak(msg); toast(msg);
      if(ROUND.found.size>=ROUND.need){ onWin(); } }
    else{ ringAt(x,y,false); const msg = randomBad();
      speak(msg); toast(msg);
    }
  }
  function dist(x1,y1,x2,y2){ const dx=x1-x2, dy=y1-y2; return Math.hypot(dx,dy); }
  function ringAt(px,py,good){
    const m=document.createElement('div');
    m.className='hotspot'+(good?' found':'');
    m.style.left=px+'%'; m.style.top=py+'%'; m.style.opacity=1;
    m.innerHTML='<span class="ping"></span>';
    $stage.appendChild(m);
    if (!good) setTimeout(()=> m.remove(), 1500);
  }

  function showHint(item){
    const msg = 'ì—¬ê¸°ë¥¼ ì¡°ê¸ˆ ë” ì‚´í´ë³¼ê¹Œìš”?';
    toast(msg); speak(msg);
    const i=(item.spots||[]).findIndex((_,i)=> !ROUND.found.has(i));
    if(i>=0){
      const h=item.spots[i];
      const g=document.createElement('div'); g.className='hotspot';
      g.style.left=h.x+'%'; g.style.top=h.y+'%';
      g.style.width=g.style.height=(h.r*60)+'px';
      g.style.opacity=.75; g.style.borderStyle='solid';
      $stage.appendChild(g);
      setTimeout(()=> g.remove(), 1600);
    }
  }

   function onWin(){
    ROUND.lock = true;
    clearInterval(GLOBAL.timerId);
    confetti();
    $result.hidden = false;

    const elapsed = $clock.textContent;
    qs('#summary').textContent = `ì˜¤ëŠ˜ì˜ ë°œê²¬: ${ROUND.step+1}ë‹¨ê³„ ë‹¨ì„œ ${ROUND.need}ê°œë¥¼ ${elapsed} ë§Œì— ì°¾ì•˜ì–´ìš”!`;

    $original.innerHTML='';
    const img = document.createElement('img');
    img.src = ROUND.item.orig; img.alt = 'ì›ë³¸ ì‚¬ì§„';
    $original.appendChild(img);

    // ë‹¤ìŒ ë‹¨ê³„ / í™ˆìœ¼ë¡œ
    const last = ROUND.step >= CONTENT[GLOBAL.category].length - 1;

    qs('#btn-replay').hidden = true; // ë‹¨ê³„ì‹ì´ë¯€ë¡œ ë‹¤ì‹œí•˜ê¸° ë²„íŠ¼ ê°ì¶¤
    const $next = qs('#btn-other');
    $next.textContent = last ? 'í™ˆìœ¼ë¡œ' : 'ë‹¤ìŒ ë‹¨ê³„ â†’';
    $next.onclick = ()=>{
      if (last){
        showCategoryClear(GLOBAL.category);
        navPlay(false);
      } else {
        ROUND.step += 1;
        $result.hidden = true;
        playStep();
      }
        function showCategoryClear(cat){
    GLOBAL.cleared[cat] = true;
    // ë¼ë””ì˜¤ ë¹„í™œì„± + ì²´í¬ ë§ˆí¬
    const input = document.querySelector(`input[name="category"][value="${cat}"]`);
    if (input){
      input.disabled = true;
      if (!/âœ…/.test(input.parentElement.innerHTML)){
        input.parentElement.innerHTML += ' âœ…';
      }
    }
    toast(`${cat==='landscape'?'í’ê²½':cat==='animal'?'ë™ë¬¼':'ìŒì‹'} ë§ˆìŠ¤í„°! ì°¸ ì˜í–ˆì–´ìš” ğŸ‘`, 1600);
    speak('ì°¸ ì˜í–ˆì–´ìš”! ì¹´í…Œê³ ë¦¬ ë§ˆìŠ¤í„°!');
  }

    };

    speak(last ? 'ì§„ì§œ ëª¨ìŠµ í™•ì¸ ì™„ë£Œ! ì¹´í…Œê³ ë¦¬ í´ë¦¬ì–´!' : 'ì§„ì§œ ëª¨ìŠµ í™•ì¸ ì™„ë£Œ! ë‹¤ìŒ ë‹¨ê³„ë¡œ ê°€ë³¼ê¹Œìš”?');
  }


  function confetti(){ $confetti.innerHTML=''; const n=80; for(let i=0;i<n;i++){ const c=document.createElement('div'); c.className='chip'; c.style.left=Math.random()*100+'%'; c.style.top=(Math.random()*-20)+'px'; c.style.background=`hsl(${Math.random()*360},80%,60%)`; c.style.animationDelay=(Math.random()*0.6)+'s'; c.style.animationDuration=(0.8+Math.random()*0.8)+'s'; $confetti.appendChild(c); } }
  function randomGood(){ return pick(['ì •ë‹µ! ì˜ ì°¾ì•˜ì–´ìš”','ë©‹ì§„ íƒì •ì´ì—ìš”','ì •í™•í•´ìš”! ì¢‹ì€ ê´€ì°°ì´ì—ìš”']); }
  function randomBad(){ return pick(['ê´œì°®ì•„ìš”, ì¡°ê¸ˆ ë” ì‚´í´ë´ìš”','ë‹¤ë¥¸ ê³³ë„ ìˆì„ ìˆ˜ ìˆì–´ìš”','ì²œì²œíˆ ë‹¤ì‹œ ë³¼ê¹Œìš”?']); }
  function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

  (function init(){
    buildGrid();
    
    // Developer mode
    let clickCount = 0;
    let clickTimer = null;
    qs('.headline').onclick = () => {
      clickCount++; clearTimeout(clickTimer);
      clickTimer = setTimeout(() => { clickCount = 0; }, 1000); 
      if (clickCount >= 5) {
        GLOBAL.dev = true; clickCount = 0;
        toast('âœ¨ ê°œë°œì ëª¨ë“œê°€ í™œì„±í™”ë˜ì—ˆìŠµë‹ˆë‹¤.');
        console.log('Developer mode ACTIVATED.');
      }
    };

    // Fullscreen
    const $fullscreenTarget = qs('.max');
    const $btnFullscreen = qs('#btn-fullscreen');
    function toggleFullscreen() {
      if (!document.fullscreenElement) {
        if ($fullscreenTarget.requestFullscreen) { $fullscreenTarget.requestFullscreen();
        } else if ($fullscreenTarget.webkitRequestFullscreen) { $fullscreenTarget.webkitRequestFullscreen();
        } else if ($fullscreenTarget.msRequestFullscreen) { $fullscreenTarget.msRequestFullscreen(); }
        $btnFullscreen.textContent = 'ğŸ–¼ï¸ ì „ì²´í™”ë©´ ë‹«ê¸°';
      } else {
        if (document.exitFullscreen) { document.exitFullscreen(); }
        $btnFullscreen.textContent = 'ğŸ–¼ï¸ ì „ì²´í™”ë©´';
      }
    }
    $btnFullscreen.onclick = toggleFullscreen;

   // Session timer
    // âœ¨ FIX: sessionStorageë¥¼ ì‚¬ìš©í•´ ìƒˆë¡œê³ ì¹¨í•´ë„ ì‹œê°„ ìœ ì§€
    let t0 = sessionStorage.getItem('sessionStartTime');
    if (!t0) {
      t0 = Date.now();
      sessionStorage.setItem('sessionStartTime', t0);
    }

    setInterval(()=>{
        const s=Math.floor((Date.now()-t0)/1000);
        const mm=String(Math.floor(s/60)).padStart(2,'0');
        const ss=String(s%60).padStart(2,'0');
        if($statTime) $statTime.textContent=`${mm}:${ss}`;
    },1000);
  })();
</script>
</body>
</html>
